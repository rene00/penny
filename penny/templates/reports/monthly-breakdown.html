{% extends "navbar.html" %}
{% block content %}
<div class="container-fluid flex-grow-1">
    <h1 class="page-header">Monthly Breakdown {% if account.name %}{{ account.name }}{% endif %}</h1>
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <form action={{ url_for('reports.account_monthly_breakdown') }} method="POST">
                {{ form.hidden_tag() }}
                {{ form.csrf_token }}
                <table class="table table-bordered" width="100%" cellspacing="0" id="table">
                    <tbody>
                        <tr>
                            <td>Account</td>
                            <td>
                                {% if form.account.errors -%}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">{{ form.account.errors[0] }}</label>
                                {% endif -%}
                                <select id="account" name="account" class="form-control">
                                {% for choice in form.account.choices %}
                                <option value="{{ choice.0 }}"{% if account and account.id|int == choice.0|int %} selected="selected"{% endif %}>{{choice.1}}</option>
                                {% endfor %}
                                </select>
                                {% if form.account.errors -%}
                                </div>
                                {% endif -%}
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="col-xs-12">
                    <div class="col-lg-2">
                        <input type="submit" class="btn btn-primary" name="submit" value="submit">
                        {{ form.submit }}
                    </div>
                </div>
                </form>

                <div class="col-lg-12">
                    <div class="table-responsive">
                        <table data-toggle="table" data-pagination="true" data-page-size="50">
                            <thead>
                                <tr>
                                    <th data-field="month">Month</th>
                                    <th data-field="amount">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for date, month in report.transactions.items()|sort(reverse=true) %}
                                {% set start_month = month.date|replace("-", "") + "01" %}
                                {% set end_month = month.date|replace("-", "") + month.daycount|string %}
                                <tr>
                                    <td>{{ date }}</td>
                                    <td><a href="{{ url_for('transactions.account', id=account.id, start_date=start_month, end_date=end_month) }}">{{ month.amount }}</a></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
